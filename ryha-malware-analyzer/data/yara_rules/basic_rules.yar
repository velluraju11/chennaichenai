rule Suspicious_PE_Characteristics
{
    meta:
        description = "Detects suspicious PE file characteristics"
        author = "Ryha Malware Analyzer"
    
    strings:
        $mz = { 4D 5A }
        $pe = "PE"
        $suspicious1 = "keylogger" nocase
        $suspicious2 = "password" nocase
        $suspicious3 = "backdoor" nocase
        $suspicious4 = "trojan" nocase
        $suspicious5 = "virus" nocase
        $suspicious6 = "malware" nocase
        $packer1 = "UPX"
        $packer2 = "VMProtect"
        $crypto1 = "CryptAcquireContext"
        $crypto2 = "CryptEncrypt"
        $network1 = "InternetOpen"
        $network2 = "HttpSendRequest"
        $registry1 = "RegSetValue"
        $registry2 = "RegCreateKey"
    
    condition:
        $mz at 0 and $pe and (
            any of ($suspicious*) or
            any of ($packer*) or
            (any of ($crypto*) and any of ($network*)) or
            any of ($registry*)
        )
}

rule Generic_Malware_Strings
{
    meta:
        description = "Generic malware string detection"
        author = "Ryha Malware Analyzer"
    
    strings:
        $string1 = "GetProcAddress" nocase
        $string2 = "LoadLibrary" nocase
        $string3 = "VirtualAlloc" nocase
        $string4 = "WriteProcessMemory" nocase
        $string5 = "CreateRemoteThread" nocase
        $string6 = "ShellExecute" nocase
        $string7 = "WinExec" nocase
        $string8 = "CreateProcess" nocase
        $string9 = "RegOpenKey" nocase
        $string10 = "RegSetValue" nocase
    
    condition:
        3 of them
}

rule Packed_Executable
{
    meta:
        description = "Detects packed executables"
        author = "Ryha Malware Analyzer"
    
    strings:
        $upx1 = "UPX0"
        $upx2 = "UPX1" 
        $upx3 = "UPX!"
        $themida = "Themida"
        $vmprotect = "VMProtect"
        $aspack = "aPLib"
        
    condition:
        any of them
}
